<%- include('partials/header.ejs') %>
<div class="content-container">
    
    <div>
        <img src="assets/images/bookshelf.png" id="bookshelf-img" alt="image of books on a shelf">
        <h1>Reader's Logbook</h1>
        <p class="header-text">
            The Reader's Logbook serves as a meticulously crafted repository 
            chronicling my extensive literary voyages. Within these virtual 
            pages lies a comprehensive archive documenting the diverse books 
            that have captured my imagination, each entry adorned with personal 
            annotations and reflections.
        </p>
        <p class="header-text">
            Delve into this curated collection to journey through my encounters 
            with varied narratives, characters, and stories that have profoundly 
            shaped my reading expedition. Explore and relish the rich tapestry of my literary adventures.
        </p>
    </div>

    <!-- NAVBAR -->
    <div class="navbar">
        <div>        
            <a href="/new-entry"><img src="assets/images/button1.png" class="nav-button" alt="navigation button new entry"></a>
        </div>
        <div>
            <a href="/about"><img src="assets/images/button2.png" class="nav-button" alt="navigation button about"></a>
        </div>
    </div>

    <!-- SORTING DROPDOWN -->
    <div>
        <form action="/sort" method="post">
            <label for="sorting">Sort Books by:</label>
            <select name="sortBy" id="sorting-dropdown" onchange="this.form.submit()">
            <option value="title" <% if (sortOption === "title") { %>selected<% } %>>Title</option>
            <option value="date" <% if (sortOption === "date") { %>selected<% } %>>Date read</option>
            <option value="rating" <% if (sortOption === "rating") { %>selected<% } %>>Rating</option>
            </select>
        </form>
    </div>

    <!-- LOG ENTRY CONTAINER -->
    <% if (data && data.length !== 0) { %>
        <% for (let i=0; i<data.length; i++) { %>
    <div class="log-entry-container">
        <div class="column1">
            <div>
                <% if (data[i].image_path !== null) { %>
                    <img src="<%= data[i].image_path %>" class="book-preview-img" alt="book cover image">
                <% } else { %>
                    <p>No book cover available</p>
                <% } %>
            </div>
            <div class="entry-text">
                Date: <%=data[i].date_read.toLocaleDateString('en-GB', { timeZone: 'UTC' });%>
            </div>
            <div>
                <form action="/notes/<%= data[i].id %>" method="get">
                    <button class="form-button" type="submit">View Notes</button>
                </form>
            </div>
            <div>
                <form action="/delete/book/<%= data[i].id %>" method="post">
                    <button type="submit" class="form-button" onclick="return confirm('Are you sure you want to delete this book?')">Delete Book</button>
                </form>
            </div>
        </div>
        <div class="column2">
            <div>
            <% if (data && data.length !== 0) { %>
                <h2><%= data[i].title %></h2>
                <p class="entry-text">by <%= data[i].author %></p>
                <h3>Description</h3>
                <p class="entry-text"><%- data[i].description %></p>
                <h3>My review</h3>
            </div>
    
            <!-- Star rating: renders the correct amounts of filled and empty stars according to rating (0 - 5) -->
            <div class="star-rating-container">
                <% const rating = data[i].rating; %>
                <% for (let i=0; i<rating; i++) { %>
                    <img src="assets/images/star-icon-filled.png" class="star-icon" alt="filled star icon">
                <% } %>
                <% if (rating < 5) { %>
                    <% const empties = 5 - data[i].rating; %>
                    <% for (let i=0; i<empties; i++) { %>
                        <img src="assets/images/star-icon-empty.png" class="star-icon" alt="empty star icon">
                    <% } %>
                <% } %>
            </div>
                    
            <div class="review-wrapper">
                <div class="entry-text" id="review<%= data[i].id %>">
                    <%- data[i].review %>
                </div>
                <div>
                    <form action="/update/review/<%= data[i].id %>" method="post">
                        <textarea id="input<%= data[i].id %>" class="review-input" name="reviewToUpdate"
                            autocomplete="off" autofocus="true" hidden="true"><%= data[i].review %></textarea>
                        <button id="done<%= data[i].id %>" class="form-button" type="submit" hidden>Done</button>
                    </form>
                    <button id="update<%= data[i].id %>" class="form-button" type="button" onclick="handler('<%= data[i].id %>')">Update Review</button>
                </div>
            </div>

            <% } else { %>
                <p>Book data not available.</p>
            <% } %>
        </div>
    </div>
        <% } %>
    <% } %>
</div>

<script>
    function handler(id) {
      document.getElementById("review" + id).setAttribute("hidden", true)
      document.getElementById("update" + id).setAttribute("hidden", true)
      document.getElementById("done" + id).removeAttribute("hidden")
      document.getElementById("input" + id).removeAttribute("hidden")
    }
</script>
<%- include('partials/footer.ejs') %>